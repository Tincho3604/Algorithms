-- 1
SELECT
 P.NOMBRE,
 P.FECHA_INICIO,
 P.DURACION, 
    CASE
        WHEN P.DURACION < 180 
            THEN 'Proyecto corto'
        WHEN P.DURACION < 260 AND P.DURACION >= 180 
            THEN 'Proyecto Mediano'
      ELSE 'Proyecto Largo'
        END
FROM PROYECTOS P;

-- 2 
UPDATE PROYECTOS
SET DURACION = DURACION + (DURACION * 1.10)
WHERE PROYECTOS.ID IN (
    SELECT PE.PROYECTO_ID
    FROM EMPLEADOS E
    INNER JOIN PROY_EMPLE PE ON E.ID = PE.EMPLEADO_ID
    INNER JOIN PROYECTOS PR ON PE.PROYECTO_ID = PR.ID
    GROUP BY PE.PROYECTO_ID
    HAVING COUNT(E.ID) > 6
);

-- 3
SELECT * FROM EMPLEADOS EMP
INNER JOIN CATEGORIAS CAT
ON EMP.CATEGORIA_CODIGO = CAT.CODIGO
INNER JOIN DEPARTAMENTOS DEPA 
ON DEPA.DPTO_ID = EMP.DEPARTAMENTO_ID
 WHERE LOWER(TRIM(CAT.DESCRIPCION)) NOT LIKE '%jefe%' 
 AND LOWER(TRIM(DEPA.NOMBRE)) NOT LIKE '%administracion%'
 AND  MONTHS_BETWEEN(SYSDATE, EMP.FECHA_ALTA) / 12 <= 15;

 --4 
SELECT 
CAT.CODIGO, 
CAT.DESCRIPCION ,
COUNT(EMP.ID)
FROM CATEGORIAS CAT 
INNER JOIN EMPLEADOS EMP
ON EMP.CATEGORIA_CODIGO = CAT.CODIGO
INNER JOIN DEPARTAMENTOS DEPA 
ON DEPA.DPTO_ID = EMP.DEPARTAMENTO_ID
WHERE DEPA.NOMBRE NOT LIKE '%RRHH%'
GROUP BY CAT.CODIGO,CAT.DESCRIPCION 
;

-- 5
DELETE FROM EMPLEADOS
WHERE ID IN (
    SELECT E.ID
    FROM EMPLEADOS E
    INNER JOIN CATEGORIAS CAT ON E.CATEGORIA_CODIGO = CAT.CODIGO
    LEFT JOIN PROY_EMPLE PE ON E.ID = PE.EMPLEADO_ID
    WHERE PE.EMPLEADO_ID IS NULL
);

-- 6


--7 
SELECT EMP.NOMBRE, EMP.APELLIDO, EMP.CUIL
FROM EMPLEADOS EMP
INNER JOIN PROY_EMPLE PE ON EMP.ID = PE.EMPLEADO_ID
INNER JOIN PROYECTOS P ON PE.PROYECTO_ID = P.ID
WHERE PE.HORAS_DEDICACION > 40
  AND (
    SELECT COUNT(PE2.PROYECTO_ID)
    FROM EMPLEADOS EMP2
    INNER JOIN PROY_EMPLE PE2 ON EMP2.ID = PE2.EMPLEADO_ID
    INNER JOIN PROYECTOS P2 ON PE2.PROYECTO_ID = P2.ID
    WHERE EMP2.ID = EMP.ID
    GROUP BY PE2.PROYECTO_ID
  ) > 3
GROUP BY EMP.NOMBRE, EMP.APELLIDO, EMP.CUIL;

--8 
